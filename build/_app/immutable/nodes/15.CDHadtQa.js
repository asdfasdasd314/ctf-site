import{t as w,a as m}from"../chunks/6w1StL2M.js";import{p as Y,a as I,s as x,c as g,i as l,j as b,r as u,l as f,f as O,t as V}from"../chunks/Bm_VgG9E.js";import{s as J}from"../chunks/8TWQb_4_.js";import{i as E}from"../chunks/Cjra9w-q.js";import{s as q}from"../chunks/ZKL_xWPK.js";import{p as z}from"../chunks/BYUgaS6m.js";import{b as X}from"../chunks/DsZ5IdFJ.js";import{o as Z}from"../chunks/BLBxmbFV.js";const $="QENPo",tt="xE=",et="gPYtx";var rt=w('<h2 class="text-2xl font-bold mb-4">A Hacking Story</h2> <p class="text-gray-700">By Gurt</p> <canvas class="mt-10"></canvas>',1),at=w('<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-75"><div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl max-w-2xl mx-4"><p class="text-red-500"> </p></div></div>'),st=w('<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50"><div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl"><svg class="animate-spin h-8 w-8 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div></div>'),ot=w(`<div><div id="turn-off-adblocker" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50"><div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl max-w-2xl mx-4"><h1 class="text-red-400 text-2xl font-bold mb-4">Turn off your adblocker to view the story!</h1> <p class="text-gray-700 dark:text-gray-300">(You don't actually have to)</p></div></div> <!> <!> <!></div>`);function ht(D,K){Y(K,!0);let L="A/qpp",P="6ifWq",A=b(""),d=b(null),k=b(!1),p=b(""),S="x23A1b",U="cE2Ks";async function W(){let t="3ajE0";f(k,!0);const e=await fetch("/api/exercises/3/story",{credentials:"include"});S="vw/M18";const r=await e.json();if(r.success){const o=S+"xx2jb"+$+P+U+et+t+L+tt,i="/KLroCv22qeCF5fg",c="PQAM7/DhRx46g7eqq2lK6A==",n=new Uint8Array(atob(o).split("").map(s=>s.charCodeAt(0))),y=new Uint8Array(atob(i).split("").map(s=>s.charCodeAt(0))),C=new Uint8Array(atob(c).split("").map(s=>s.charCodeAt(0))),h=atob(r.story),v=new Uint8Array(h.length);for(let s=0;s<h.length;s++)v[s]=h.charCodeAt(s);try{const s=await crypto.subtle.importKey("raw",n,{name:"AES-GCM",length:256},!1,["decrypt"]),T=new Uint8Array(v.length+C.length);T.set(v),T.set(C,v.length);const Q=await crypto.subtle.decrypt({name:"AES-GCM",iv:y,tagLength:128},s,T),R=new TextDecoder().decode(Q);f(A,z(R))}catch(s){console.error("Decryption error:",s),f(p,"Failed to decrypt the story. Please try again.")}}else r.success===!1?f(p,z(r.message)):f(p,"An error occurred. Please try again.");f(k,!1)}function B(){if(!l(d))return;const t=l(d).getContext("2d");if(!t)return;t.clearRect(0,0,l(d).width,l(d).height),t.font="16px monospace",t.fillStyle="black",t.textBaseline="top";const e=20,r=l(d).width-20;let a=10,o=10;const i=l(A).split(" ");let c="";for(let n=0;n<i.length;n++){const y=c+i[n]+" ";t.measureText(y).width>r&&n>0?(t.fillText(c,a,o),c=i[n]+" ",o+=e):c=y,i[n].startsWith("flag{")&&(c.trim()!==i[n]&&(t.fillText(c.replace(i[n],""),a,o),a+=t.measureText(c.replace(i[n],"")).width),t.font="bold 16px sans-serif",t.fillStyle="red",t.fillText(i[n],a,o),t.font="16px monospace",t.fillStyle="black",a=10,o+=e,c="")}t.fillText(c,a,o)}Z(async()=>{await W(),B();const t=document.getElementById("turn-off-adblocker");t&&(document.body.style.overflow="hidden");const e=new MutationObserver(a=>{for(const o of a)for(const i of o.removedNodes)i===t&&e.disconnect()}),r=t.parentNode;e.observe(r,{childList:!0})});var _=ot(),j=x(g(_),2);{var G=t=>{var e=rt(),r=x(O(e),4);q(r,"width",800),q(r,"height",4e3),X(r,a=>f(d,a),()=>l(d)),m(t,e)};E(j,t=>{l(A)&&t(G)})}var M=x(j,2);{var H=t=>{var e=at(),r=g(e),a=g(r),o=g(a,!0);u(a),u(r),u(e),V(()=>J(o,l(p))),m(t,e)};E(M,t=>{l(p)&&t(H)})}var N=x(M,2);{var F=t=>{var e=st();m(t,e)};E(N,t=>{l(k)&&t(F)})}u(_),m(D,_),I()}export{ht as component};
